# 美容室売上照合システム

美容室のSquare（レジ）とサロンボードの売上データを照合し、差分を検出するWebアプリケーションです。

## 機能

- **ファイルアップロード**: Square CSV と サロンボード PDF のドラッグ&ドロップ対応
- **UTF-16LE対応**: SquareのCSVファイルを正しく読み込み
- **自動照合**: 日付・時間・担当者・売上・ポイントの一致確認
- **差分検出**: データのズレを一覧表示
- **レスポンシブ**: PC・スマホ両対応

## データ対応関係

### Square CSV
- **日付**: `日付` 列
- **時間**: `時間` 列  
- **売上**: `純売上高` + `税金`
- **割引**: `ディスカウント` 列
- **担当者**: `詳細` 列から抽出

### サロンボード PDF
- **日付・時間**: `会計日時`
- **売上**: `現計`
- **ポイント**: `ポイント利用額`
- **担当者**: `担当スタイリスト`

## 使用方法

1. **ファイル準備**
   - SquareからCSVをダウンロード
   - サロンボードからPDFを印刷/保存

2. **アップロード**
   - 左側: Square CSV をアップロード
   - 右側: サロンボード PDF をアップロード

3. **照合実行**
   - 「照合開始」ボタンをクリック
   - 差分結果を確認

## 技術仕様

- **フロントエンド**: HTML/CSS/JavaScript (Vanilla)
- **PDF処理**: PDF.js
- **文字エンコーディング**: UTF-16LE/UTF-8 自動判定
- **照合ロジック**: 時間差5分以内、名前部分一致対応

## ファイル構成

```
regi-check/
├── index.html          # メインUI
├── app.js              # アプリケーションロジック
├── test.js             # テストスクリプト
├── sample_data/        # サンプルデータ
│   ├── お取引-2025-06-22-2025-06-23.csv
│   └── SALON BOARD _ ジャーナル印刷確認.pdf
└── README.md
```

## ローカル実行

```bash
# HTTPサーバー起動
python3 -m http.server 8000

# ブラウザでアクセス
open http://localhost:8000
```

## データ処理の特徴

### CSV解析
- UTF-16LE BOM自動検出
- タブ区切り形式対応
- 金額文字列の正規化（"¥4,200" → 4200）
- 担当者名の抽出（"貴士 (定価)" → "貴士"）

### 照合アルゴリズム
- **日付**: 完全一致
- **時間**: ±5分以内
- **担当者**: 部分一致（「清田 貴士」⇔「貴士」）
- **金額**: Square（純売上高+税金）⇔ サロンボード（現計）
- **ポイント**: Square（ディスカウント）⇔ サロンボード（ポイント利用額）

## 注意事項

- サロンボードPDFの1ページ目は自動的にスキップされます
- 時間の照合は5分以内の差を許容します
- 担当者名は部分一致で照合します
- PDFの構造によっては手動調整が必要な場合があります

## 今後の改善点

- [ ] PDFパース精度の向上
- [ ] CSVフォーマットの自動判定
- [ ] 照合結果のエクスポート機能
- [ ] 複数日付データの一括処理