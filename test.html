<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-box { border: 2px dashed #ccc; padding: 20px; margin: 20px 0; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-box">
        <h3>CSVãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ</h3>
        <input type="file" id="testCsv" accept=".csv">
        <div id="csvResult" class="log"></div>
    </div>
    
    <div class="test-box">
        <h3>PDFãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ</h3>
        <input type="file" id="testPdf" accept=".pdf">
        <div id="pdfResult" class="log"></div>
    </div>
    
    <script>
        console.log('ğŸ”§ ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
        
        document.getElementById('testCsv').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            const resultDiv = document.getElementById('csvResult');
            
            if (!file) {
                resultDiv.innerHTML = 'âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“';
                return;
            }
            
            console.log('ğŸ“ CSV test file:', file.name, file.size, 'bytes');
            resultDiv.innerHTML = `ğŸ“ é¸æŠ: ${file.name} (${file.size} bytes)`;
            
            try {
                // ç°¡å˜ãªãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šãƒ†ã‚¹ãƒˆ
                const arrayBuffer = await file.arrayBuffer();
                const uint8Array = new Uint8Array(arrayBuffer);
                
                // UTF-16LE BOMæ¤œå‡º
                if (uint8Array.length >= 2 && uint8Array[0] === 0xFF && uint8Array[1] === 0xFE) {
                    resultDiv.innerHTML += '<br>âœ… UTF-16LE BOMæ¤œå‡º';
                    
                    const decoder = new TextDecoder('utf-16le');
                    const text = decoder.decode(arrayBuffer);
                    const lines = text.split('\\n');
                    
                    resultDiv.innerHTML += `<br>ğŸ“Š ç·è¡Œæ•°: ${lines.length}`;
                    resultDiv.innerHTML += `<br>ğŸ“‹ ãƒ˜ãƒƒãƒ€ãƒ¼: ${lines[0].substring(0, 100)}...`;
                    
                } else {
                    resultDiv.innerHTML += '<br>âš ï¸ UTF-8ã¨ã—ã¦èª­ã¿å–ã‚Š';
                    const decoder = new TextDecoder('utf-8');
                    const text = decoder.decode(arrayBuffer);
                    resultDiv.innerHTML += `<br>ğŸ“Š æ–‡å­—æ•°: ${text.length}`;
                }
                
            } catch (error) {
                console.error('CSV test error:', error);
                resultDiv.innerHTML += `<br>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        });
        
        document.getElementById('testPdf').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            const resultDiv = document.getElementById('pdfResult');
            
            if (!file) {
                resultDiv.innerHTML = 'âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“';
                return;
            }
            
            console.log('ğŸ“ PDF test file:', file.name, file.size, 'bytes');
            resultDiv.innerHTML = `ğŸ“ é¸æŠ: ${file.name} (${file.size} bytes)`;
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                const uint8Array = new Uint8Array(arrayBuffer);
                
                // PDFãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
                const header = new TextDecoder('ascii').decode(uint8Array.slice(0, 20));
                
                if (header.startsWith('%PDF')) {
                    resultDiv.innerHTML += `<br>âœ… PDFãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª: ${header.substring(0, 10)}`;
                    resultDiv.innerHTML += `<br>ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${(arrayBuffer.byteLength / 1024).toFixed(1)} KB`;
                } else {
                    resultDiv.innerHTML += '<br>âŒ PDFãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“';
                }
                
            } catch (error) {
                console.error('PDF test error:', error);
                resultDiv.innerHTML += `<br>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        });
    </script>
</body>
</html>